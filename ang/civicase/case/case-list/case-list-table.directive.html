<div crm-ui-debug="selectedCases"></div>
<div class="civicase__case-list">
  <civicase-bulk-actions-message
    selected-items="selectedCases.length" total-count="totalCount"
    is-select-all-available="isSelectAllAvailable" show-checkboxes="showCheckboxes"
    ng-hide="viewingCase">
  </civicase-bulk-actions-message>
  <div
    class="panel panel-default civicase__case-list-panel"
    ng-class="{'civicase__case-list-panel--summary': viewingCase, 'civicase__case-list-panel--focused': caseIsFocused}">
    <div class="civicase__case-list-table-container" civicase-sticky-table-header>
      <table ng-show="!caseIsFocused" class="table civicase__case-list-table" >
        <thead class="civicase__case-list-table__header">
        <tr>
          <th class="civicase__case-list-column--fixed civicase__case-list-column--first">
            <civicase-bulk-actions-checkboxes
              ng-show="!viewingCase && selectedCases && bulkAllowed && !item.lock"
              class="pull-left"
              show-checkboxes="showCheckboxes"
              is-select-all-available="isSelectAllAvailable"
              selected-items="selectedCases.length"
              everything-count="totalCount"
              displayed-count="cases.length">
            </civicase-bulk-actions-checkboxes>
            <span
              class="civicase__bulkactions-actions-dropdown btn-group btn-group-sm"
              ng-if="!viewingCase && selectedCases && bulkAllowed && !item.lock">
              <div class="btn-group">
                <button
                  type="button" class="btn btn-default"
                  ng-class="{disabled: !selectedCases.length || !showCheckboxes}"
                  data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  {{ ts('Actions') }}
                </button>
                <button
                  type="button" class="btn btn-default dropdown-toggle"
                  ng-class="{disabled: !selectedCases.length || !showCheckboxes}"
                  data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" civicase-case-actions="selectedCases" is-bulk-mode="true" refresh-callback="refresh"></ul>
              </div>
            </span>
            <span class="btn-group btn-group-sm pull-right" ng-if="sort.sortable">
              <select class="form-control civicase__case-sort-dropdown" ng-model="sort.field" crm-ui-select>
                <option value="id">{{ ts('Case ID') }}</option>
                <option value="contact_id.sort_name">{{ ts('Case Client') }}</option>
                <option value="subject">{{ ts('Subject') }}</option>
                <option value="status_id.label">{{ ts('Status') }}</option>
                <option value="case_type_id.title">{{ ts('Type') }}</option>
                <option value="start_date">{{ ts('Start Date') }}</option>
                <option value="end_date">{{ ts('End Date') }}</option>
                <option value="created_date">{{ ts('Date Created') }}</option>
                <option value="modified_date">{{ ts('Last Updated') }}</option>
                <option value="case_manager.sort_name">{{ ts('Case Manager') }}</option>
                <option value="my_role.label_b_a">{{ ts('My Role') }}</option>
                <option value="next_activity">{{ ts('Next Activity') }}</option>
                <option value="next_activity_category_milestone">{{ ts('Next Milestone') }}</option>
                <option value="next_activity_category_task">{{ ts('Next Task') }}</option>
                <option value="next_activity_category_communication">{{ ts('Next Communication') }}</option>
              </select>
              <i class="civicase__case-list__toggle-sort material-icons" ng-click="changeSortDir()">
                import_export
              </i>
            </span>
          </th>
          <th
            ng-show="!viewingCase"
            ng-repeat="header in headers"
            civicase-case-list-sort-header="{{ header.sort }}">{{ header.label }}</th>
        </tr>
        </thead>
        <tbody>
        <tr ng-if="!isLoading" ng-repeat="item in cases" >
          <td ng-click="viewCase(item.id, $event)">
            <civicase-case-card mode="case-list" case="item"></civicase-case-card>
          </td>
          <td
            ng-show="!viewingCase"
            ng-repeat="header in headers"
            ng-class="{'case-activity-card-wrapper': header.display_type == 'activity_card'}">

            <span ng-switch on="header.display_type">
              <span ng-switch-when="activity_card">
                <div
                  ng-if="!item.lock"
                  case-activity-card="item[header.name]"
                  refresh-callback="refresh"
                  case="item"
                  crm-popup-form-success="refresh()"
                >
                </div>
              </span>
              <span ng-switch-when="status_badge" class="crm_notification-badge" style="background-color: {{ item.color }};">
                {{ item.status }}
              </span>
              <span ng-switch-when="contact_reference">{{ item[header.name].display_name }}</span>
              <span ng-switch-when="date">{{ CRM.utils.formatDate(item[header.name]) }}</span>
              <span ng-switch-when="multiple_values">{{ item[header.name].join(', ') }}</span>
              <span ng-switch-default>{{ item[header.name] }}</span>
            </span>
          </td>
        </tr>
        <!-- Loading state HTML -->
        <tr class="civicase__case-placeholder-row" ng-repeat="placeholder in casePlaceholders" ng-if="isLoading">
          <td>
            <div class="civicase__case-card panel-default panel-strip-primary civicase__loading-placeholder__oneline-strip">
              <div class="panel-body">
                <h2 style="width: 60%; margin-top: 10px;" class="civicase__loading-placeholder__oneline"></h2>
                <div style="width: 80%; margin-top: 10px;" class="civicase__loading-placeholder__oneline"></div>
                <div style="width: 60%; margin-top: 10px;" class="civicase__loading-placeholder__oneline"></div>
                <div style="width: 80%; margin-top: 10px;" class="civicase__loading-placeholder__oneline"></div>
                <div style="width: 50%; margin-top: 10px;" class="civicase__loading-placeholder__oneline"></div>
              </div>
            </div>
          </td>
          <td ng-show="!viewingCase"><div class="civicase__loading-placeholder__activity-card"><div></div></div></td>
          <td ng-show="!viewingCase" ng-repeat="i in [1,2,3,4,5,6,7]"><div class="civicase__loading-placeholder__oneline"></div></td>
        </tr>
        <!-- Empty State HTML -->
        <tr ng-if="!cases.length && !isLoading" class="civicase__panel-empty">
          <td></td>
          <td colspan="{{ headers.length }}">
            <i class="fa fa-folder-o fa-big"></i>
            <div class="empty-label">{{ ts('No cases found matching the search criteria.') }}</div>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
    <div class="center-block civicase__pager" civicase-sticky-footer-pager>
      <paging
        ng-show="!caseIsFocused && page.total > 1"
        page="page.num"
        page-size="page.size"
        total="totalCount"
        adjacent="1"
        dots="..."
        show-prev-next="true"
        show-first-last="true"
        text-first="{{ ts('First') }}"
        text-last="{{ ts('Last') }}"
        text-next="{{ ts('Next') }}"
        text-prev="{{ ts('Prev') }}"
      ></paging>
    </div>
  </div>
  <div
    class="panel panel-default civicase__case-details-panel"
    ng-class="{'civicase__case-details-panel--focused': caseIsFocused, 'civicase__case-details-panel--summary': viewingCase}"
    civicase-case-details="viewingCaseDetails"
    civicase-tab="viewingCaseTab"
    civicase-focused="caseIsFocused"></div>
  </div>
</div>
