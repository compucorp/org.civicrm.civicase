<div
  class="civicase__activity-card civicase__activity-card--long"
  ng-click="viewActivityDetails($event, activity)"
  ng-class="{
    'civicase__activity-card--draft': activity.status==='Draft',
    'civicase__activity-card--ribbon': activity.category.indexOf('milestone') > -1,
    'civicase__activity-card--with-checkbox': activity.category.indexOf('task') > -1,
    'civicase__activity-card--alert': activity.category.indexOf('alert') > -1,
    'civicase__activity-card--file': activity.type === 'File Upload'
  }">
  <div class="panel panel-default">
    <div class="panel-body">
      <div class="civicase__activity-card-row civicase__activity-card-row--first">
        <span ng-if="activity.icon || activity.category.indexOf('milestone') > -1" activity-icon="activity"></span>
        <!-- Task - Checkbox -->
        <span
          ng-if="activity.category.indexOf('task') > -1"
          class="civicase__checkbox"
          title="{{ activity.is_completed ? ts('Mark incomplete') : ts('Mark complete') }}"
          ng-click="markCompleted(activity); $event.stopPropagation();"
          role="checkbox" aria-checked="{{activity.is_completed}}" tabindex="0" aria-labelledby="Mark complete/incomplete">
          <i ng-if="activity.is_completed" class="civicase__checkbox--checked material-icons">check_box</i>
        </span>
        <!-- End - Task - Checkbox -->
        <!-- Type -->
        <span
          class="civicase__activity-type"
          ng-if="activity.type !== 'File Upload'"
          ng-class="{'civicase__activity-type--completed': (activity.category.indexOf('task') > -1 && activity.is_completed)}">
          {{ activity.type }}
        </span>
        <span
          class="civicase__activity-subject"
          ng-if="activity.type === 'File Upload'">
          {{ activity.subject || activity.type }}
        </span>
        <!-- End - Type -->
        <!-- Attachments -->
        <div class="btn-group civicase__activity-attachment__container" ng-if="activity.type !== 'File Upload' && activity.file_id">
          <i ng-mouseover="getAttachments(activity)" class="civicase__activity-attachment__icon material-icons">attach_file</i>
          <ul class="dropdown-menu">
            <li ng-if="!activity.attachments || !activity.attachments.length" class="civicase__activity-attachment-load">
              <span>
                <i class="civicase__activity-attachment-load-icon text-primary material-icons">loop</i> &nbsp;{{ ts('Loading...') }}
              </span>
            </li>
            <li ng-repeat="file in activity.attachments || []">
              <a class="civicase__activity-attachment__file-name"
                title="{{ file.description || ts('Download File') }}"
                href="{{ file.url }}">
                <i class="civicase__activity-attachment__file-icon crm-i {{ file.icon }}"></i> &nbsp;{{ file.name }}
              </a>
            </li>
            <li ng-if="activity.attachments.length" role="separator" class="divider"></li>
            <li ng-if="activity.attachments.length">
              <a class="civicase__activity-attachment__file-name"
                ng-href="{{ 'civicrm/case/activity/download-all-files' | civicaseCrmUrl:{ activity_id: activity.id } }}">
                <i class="civicase__activity-attachment__file-icon crm-i fa-download"></i> &nbsp;Download all
              </a>
            </li>
          </ul>
        </div>
        <!-- End - Attachments -->
        <span class="civicase__activity__right-container" ng-if="activity.category.indexOf('alert') === -1">
          <!-- Tags -->
          <div class="civicase__activity__tags-container" ng-if="activity.tag_id">
            <span
              class="badge"
              title="{{ tag['tag_id.description'] }}"
              ng-repeat="tag in activity.tag_id || []"
              style="background-color: {{ tag['tag_id.color'] }};"
            >{{ tag['tag_id.name'] }}</span>
          </div>
          <!-- End - Tags -->

          <!-- Rating -->
          <a ng-click="toggleActivityStar($event, activity)" href ng-if="activity.is_star" title="{{ activity.is_star === '0' ? ts('Add star') : ts('Unstar') }}">
            <i ng-if="activity.is_star === '0'" class="civicase__activity-star material-icons">star_border</i>
            <i ng-if="activity.is_star === '1'" class="civicase__activity-star active material-icons">star</i>
          </a>
          <!-- End - Rating -->

          <!-- Activity Date -->
          <span class="civicase__activity-date" ng-class="{'civicase__overdue-activity-icon': activity.is_overdue}">{{formatDate(activity.activity_date_time, 'DD MMM YYYY')}}</span>
          <!-- End - Activity Date -->

          <!-- Avatar -->
          <span ng-if="activity.assignee_contact_name" contact-card avatar="true" contacts="activity.assignee_contact_name"></span>
          <!-- End - Avatar -->
          <div ng-include="'~/civicase/activity/activity-card/activity-card-menu-feed.html'" ng-if="bulkAllowed"></div>
        </span>
      </div>
      <div class="civicase__activity-card-row">
        <!-- Subject -->
        <div ng-if="activity.type !== 'File Upload'" class="civicase__activity-subject">{{ activity.subject }}</div>
        <!-- End - Subject -->
      </div>
      <div class="civicase__activity-card-row civicase__activity-card-row--communication" ng-if="activity.category.indexOf('communication') > -1">
        <div>
          <span>To:&nbsp;</span>
          <span ng-if="activity.target_contact_name" contact-card contacts="activity.target_contact_name"></span>
        </div>
        <div class="civicase__activity__right-container">
          <span>From:&nbsp;</span>
          <span ng-if="activity.source_contact_id" contact-card contacts="activity.source_contact_id"></span>
        </div>
      </div>
      <div class="civicase__activity-card-row" ng-if="activity.category.indexOf('alert') > -1">
        <!-- Tags for alert-->
        <div class="civicase__activity__tags-container" ng-if="activity.tag_id">
          <span
            class="badge"
            title="{{ tag['tag_id.description'] }}"
            ng-repeat="tag in activity.tag_id || []"
            style="background-color: {{ tag['tag_id.color'] }};"
          >{{ tag['tag_id.name'] }}</span>
        </div>
        <!-- End - Tags for alert -->
      </div>

      <div class="civicase__activity-card-row civicase__activity-card-row--file" ng-if="activity.type === 'File Upload'" ng-init="getAttachments(activity)">
        <div ng-repeat="file in activity.attachments || []">
          <a class="civicase__activity-attachment__file-name"
            title="{{ file.description || ts('Download File') }}"
            href="{{ file.url }}">
            {{ file.name }}
          </a>
          <div ng-include="'~/civicase/activity/activity-card/activity-card-menu-file.html'" class="civicase__activity-attachment__file-options" ng-if="bulkAllowed"></div>
          <div class="civicase__activity-attachment__file-description">{{ file.description }}</div>
        </div>
      </div>
    </div>
    <!-- Case information -->
    <div class="panel-footer" ng-if="activity.case">
      <div class="civicase__activity-card-row civicase__activity-card-row--case-info" >
        <span>
          <span class="civicase__activity-card__case-id__label">Case ID:</span>
          <span class="civicase__activity-card__case-id__value">{{activity.case_id}}</span>
        </span>
        <span class="civicase__pipe"> | </span>
        <span class="civicase__activity-card__case-type">{{ activity.case.type.title }}</span>
        <div class="civicase__activity__right-container">
          <div>
            <span contact-card contacts="activity.case.client"></span>
          </div>
          <span class="crm_notification-badge" style="background-color: {{ activity.case.status.color }};">{{ activity.case.status.label }}</span>
        </div>
      </div>
    </div>
    <!-- End - Case information -->
  </div>
</div>
